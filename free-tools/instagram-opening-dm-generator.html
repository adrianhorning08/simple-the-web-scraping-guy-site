<!-- Design inspired by https://coldemailwizard.io/ -->
<html
  lang="en"
  class="h-full scroll-smooth bg-white antialiased dark:bg-black text-zinc-900 dark:text-zinc-100"
>
  <head>
    <!-- Google tag (gtag.js) NEEDS TO BE ON EVERY PAGE!!!! -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-3T546XY43S"
    ></script>
    <meta charset="utf-8" />
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="icon" type="image/x-icon" href="favicon.ico" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;200;300;400;500;600;700;800;900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Instagram DM Line Generator</title>
    <meta name="description" content="Instagram DM Line Generator" />
    <meta name="keywords" content="instagram, dm, line, generator" />
    <meta name="author" content="Adrian Horning" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16" />

    <script>
      // Tailwind CSS doesn't automatically switch between dark and light modes based on OS settings.
      // This script adds the correct class to the HTML element based on the user's preference.
      if (
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches
      ) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>
    <style>
      body {
        font-family: "Outfit", sans-serif;
      }
    </style>
  <body class="bg-gradient-to-br from-pink-50 to-purple-50 dark:from-gray-900 dark:to-purple-900 min-h-screen flex flex-col items-center justify-center p-4">
    <!-- Back Button -->
    <a href="/free-tools" class="absolute top-4 left-4 text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-200 flex items-center gap-2 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
      </svg>
      Back to Tools
    </a>

    <div class="max-w-md w-full bg-white/80 dark:bg-gray-800/90 backdrop-blur-sm rounded-2xl shadow-lg p-8 border border-purple-100 dark:border-purple-900">
      <div class="flex items-center justify-center gap-2 mb-4">
        <span class="text-3xl">üíå</span>
        <h1 class="text-2xl font-bold bg-gradient-to-r from-pink-600 to-purple-600 dark:from-pink-400 dark:to-purple-400 text-transparent bg-clip-text text-center">
          Instagram DM Generator
        </h1>
        <span class="text-3xl">‚ú®</span>
      </div>

      <p class="text-gray-600 dark:text-gray-300 text-center mt-2">
        Let's craft a fun (and slightly cheesy) opening line for your Instagram crush! üòâ
      </p>

      <form id="dmForm" class="mt-6">
        <label for="igHandle" class="block text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" />
          </svg>
          Instagram Handle
        </label>
        <div class="relative mt-1">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <span class="text-gray-500 dark:text-gray-400">@</span>
          </div>
          <input
            type="text"
            id="igHandle"
            name="igHandle"
            class="block w-full pl-8 pr-10 py-2 border-2 border-purple-200 dark:border-purple-700 dark:bg-gray-700 dark:text-white rounded-lg shadow-sm focus:ring-pink-500 focus:border-pink-500 transition-colors sm:text-sm"
            placeholder="sydney_sweeney"
            required
          />
        </div>

        <button
          type="submit"
          class="w-full mt-4 px-4 py-3 bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white text-sm font-medium rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-150 focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 relative"
        >
          <span id="buttonText">‚ú® Generate Magic ‚ú®</span>
          <div id="loader" class="hidden absolute inset-0 flex items-center justify-center">
            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </div>
        </button>
      </form>

      <div id="output" class="mt-6 hidden">
        <h2 class="text-lg font-semibold text-gray-800 dark:text-white flex items-center gap-2">
          <span>üíù</span> Your Opening Line:
        </h2>
        <div class="relative mt-2">
          <p id="dmLine" class="text-gray-700 dark:text-gray-300 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-gray-700 dark:to-gray-700 p-6 rounded-lg border border-purple-100 dark:border-purple-800"></p>
          <button 
            id="copyButton"
            class="absolute top-3 right-3 p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 bg-white dark:bg-gray-600 rounded-lg shadow-sm hover:shadow-md transition-all duration-150"
            title="Copy to clipboard"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
              <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
            </svg>
          </button>
        </div>

        <!-- Add Post Captions Section -->
        <div class="mt-6">
          <h2 class="text-lg font-semibold text-gray-800 dark:text-white flex items-center gap-2">
            <span>üìù</span> Recent Post Captions:
          </h2>
          <div id="postCaptions" class="mt-2 space-y-3">
            <!-- Captions will be inserted here -->
          </div>
        </div>
      </div>

      <div class="text-center text-sm text-gray-500 dark:text-gray-400 mt-6 flex flex-col items-center gap-2">
        <p>Powered by AI Magic ‚ú®</p>
        <p class="text-xs">Disclaimer: Results may cause unexpected romance or awkward situations üòÖ</p>
      </div>
    </div>

    <script>
      const form = document.getElementById("dmForm");
      const output = document.getElementById("output");
      const dmLine = document.getElementById("dmLine");
      const buttonText = document.getElementById("buttonText");
      const loader = document.getElementById("loader");
      const postCaptions = document.getElementById("postCaptions");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const igHandle = document.getElementById("igHandle").value.replace('@', '');

        buttonText.classList.add("invisible");
        loader.classList.remove("hidden");

        try {
          const response = await fetch(
            `https://long-running-server.onrender.com/generate-opening-line?handle=${igHandle}`,
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
            }
          );

          if (response.ok) {
            const data = await response.json();
            dmLine.textContent = data.message;
            
            // Clear previous captions
            postCaptions.innerHTML = '';
            
            // Add each caption
            if (data.postCaptions && data.postCaptions.length > 0) {
              data.postCaptions.forEach((caption, index) => {
                const captionElement = document.createElement('div');
                captionElement.className = 'p-4 bg-white/50 dark:bg-gray-700/50 rounded-lg border border-purple-100 dark:border-purple-800';
                
                const postNumber = document.createElement('div');
                postNumber.className = 'text-sm text-purple-600 dark:text-purple-400 mb-1';
                postNumber.textContent = `Post ${index + 1}`;
                
                const captionText = document.createElement('div');
                captionText.className = 'text-gray-700 dark:text-gray-300';
                captionText.textContent = caption;
                
                captionElement.appendChild(postNumber);
                captionElement.appendChild(captionText);
                postCaptions.appendChild(captionElement);
              });
            } else {
              const noCaptions = document.createElement('div');
              noCaptions.className = 'text-gray-500 dark:text-gray-400 text-center p-4';
              noCaptions.textContent = 'No captions found';
              postCaptions.appendChild(noCaptions);
            }
          } else {
            const data = await response.json();
            dmLine.textContent = data.message || "Something went wrong. Please try again later.";
            postCaptions.innerHTML = '';
          }
          output.classList.remove("hidden");
        } catch (error) {
          dmLine.textContent = "Something went wrong. Please try again later.";
          postCaptions.innerHTML = '';
          output.classList.remove("hidden");
        } finally {
          buttonText.classList.remove("invisible");
          loader.classList.add("hidden");
        }
      });

      // Add copy button functionality
      const copyButton = document.getElementById("copyButton");
      
      copyButton.addEventListener("click", async () => {
        const textToCopy = dmLine.textContent;
        
        try {
          await navigator.clipboard.writeText(textToCopy);
          
          // Visual feedback
          copyButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
          `;
          
          // Reset button after 2 seconds
          setTimeout(() => {
            copyButton.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
              </svg>
            `;
          }, 2000);
        } catch (err) {
          console.error('Failed to copy text: ', err);
        }
      });
    </script>
  </body>
</html>
